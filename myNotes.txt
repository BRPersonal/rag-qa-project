Setup Project
--------------
$ uv init --python 3.12.4
$ uv add --requirements requirements.txt
$ uv add --requirements requirements-dev.txt

Once pyproject.toml is created, you can delete requirements.txt
But for this project, it is referred in Dockerfile and hence we
need to keep it. uv build does not require, but docker build requires it

verify the python version
$ cat .python-version 
$ cat pyproject.toml
$ ls -alt # you should see uv.lock

If you have pyproject.toml file , run
$ uv sync
It will create the virtual environment, install all the packages and create uv.lock file
You are all set

Test docker build in local
docker build -t rag-qa-test .
docker run --rm --name="rag-qa-test" -p 8000:8000 --env-file .env rag-qa-test

Browse the urls
http://localhost:8000/health
http://localhost:8000/config-check
http://localhost:8000/docs

After finishing remove the image
docker rmi rag-qa-test

Refer claude chat
https://claude.ai/share/7a6359c6-9696-429a-85de-99a08ed89901

Debugging
---------
docker build was failing with error
ERROR: failed to build: failed to solve: error getting credentials - err: exec: "docker-credential-desktop": executable file not found in $PATH, out: 

$ find /Applications/Docker.app -name "docker-credential-desktop" 2>/dev/null
/Applications/Docker.app/Contents/Resources/bin/docker-credential-desktop

export PATH="$PATH:/Applications/Docker.app/Contents/Resources/bin"

Now docker build command worked
Add this export permanently to ~/.zshrc

#Let it be as it is. I have not changed it
$ cat ~/.docker/config.json
{
	"auths": {},
	"credsStore": "desktop",
	"currentContext": "desktop-linux"
}


Github Workflow steps
---------
Here's the complete flow:
```
1. You push code to GitHub 'main' branch
   â†“
2. GitHub Actions workflow triggers
   â†“
3. JOB 1: Build & Push
   - Checks out your code
   - Authenticates with AWS
   - Builds Docker image using Dockerfile
   - Pushes image to AWS ECR
   - Outputs image URI
   â†“
4. JOB 2: Deploy
   - Takes the image URI from Job 1
   - Deploys to AWS App Runner
   - Sets environment variables
   - Waits for service to be ready
   - Runs health check
   â†“
5. Your app is live at the App Runner URL! ğŸ‰

# app/main.py
from fastapi import FastAPI
from app.config import settings

app = FastAPI()

@app.get("/health")
async def health():
    return {"status": "healthy"}

@app.get("/config-check")
async def config_check():
    # For debugging (don't expose actual keys!)
    return {
        "has_openai_key": bool(settings.OPENAI_API_KEY),
        "has_qdrant_key": bool(settings.QDRANT_API_KEY),
        "qdrant_url": settings.QDRANT_URL,
        "llm_model": settings.LLM_MODEL
    }
```

---

## **Visual Comparison how env vars are passed to code in local and prod** ğŸ“Š

### **Local Development:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  .env file  â”‚
â”‚  (on disk)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ python-dotenv reads it
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  os.getenv()        â”‚
â”‚  gets values        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Your FastAPI app   â”‚
â”‚  uses the values    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Production (App Runner):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GitHub Secrets      â”‚
â”‚  (stored in GitHub)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ GitHub Actions reads them
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GitHub Actions      â”‚
â”‚  passes to App Runnerâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ App Runner injects as ENV vars
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Docker Container           â”‚
â”‚  (no .env file inside!)     â”‚
â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  os.getenv()        â”‚   â”‚
â”‚  â”‚  reads ENV vars     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â†“               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Your FastAPI app   â”‚   â”‚
â”‚  â”‚  uses the values    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜